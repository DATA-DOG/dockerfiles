FROM datadoglt/base:latest
MAINTAINER "DataDog" <info@datadog.lt>

ENV REMI_REPO http://rpms.famillecollet.com/enterprise/remi-release-7.rpm

CMD /usr/sbin/php-fpm -F

EXPOSE 9000

# Install remi repo
RUN yum install -y $REMI_REPO && yum clean all

# install php with packages
# if soap extension is missing it fails to launch fpm
# related to soap wsdl cache dir in www.conf
RUN yum install --enablerepo=remi,remi-php56 -y \
  php-fpm \
  php-cli \
  php-mcrypt \
  php-pdo \
  php-mysql \
  php-mbstring \
  php-intl \
  php-soap \
  && yum clean all

# change permissions for default php session and wsdl cache directories
RUN chown www:www -R /var/lib/php/session && \
    chown www:www -R /var/lib/php/wsdlcache

# set custom configuration
RUN echo "date.timezone=UTC" > /etc/php.d/30-timezone.ini && \
    echo "cgi.fix_pathinfo=0" > /etc/php.d/30-cgi.ini && \
    echo "display_errors=stderr" > /etc/php.d/30-errors.ini

# copy default configuration of fpm
COPY www.conf /etc/php-fpm.d/www.conf
